<!DOCTYPE HTML >
<html>

<head>
	<title>Snaptorial</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
	<link rel="stylesheet" href="assets/css/main.css" />
	<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css"  babakshay loves baru/><![endif]-->
	<script src="http://antimatter15.com/ocrad.js/ocrad.js">
	</script>

	<style>
		.right {
			position: relative;
			right: -1000px;
			top: 100px;
		}
	/*	.top{
			position:relative;
			right:-1em;
		}*/

		ul {
			list-style-type: none;
		}
		body{
		color: #585858;
		font-family: "Source Sans Pro", Helvetica, sans-serif;
		font-size: 16pt;
		font-weight: 300;
		line-height: 1.75;
		}
		main{
			background-color: #fff;
			color:black;
		}
		footer{
			backgroud-color:white
		}
	</style>
</head>

<body>
	<!-- Wrapper -->
	<div id="wrapper">
<center>
		<!-- Header -->
		<div class="top">
		<header id="header">
		<div class="inner">

				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">Snaptorial</span>
				</a>

			</div>
		</header>

		<!-- Main -->
		<div id="main">
			<div class="inner">
				<header>
					<h1>Snaptorial
					</h1>
					<button id="authorize-button" style="display: none;">Authorize</button>
					<button id="signout-button" style="display: none;">Sign Out</button>
					<pre id="content"></pre>

					<section>
						<input id="image" type="file" onchange="readURL(this)" />
						<br/>
						<br/>
						<button onclick="callOcrad(imgData)" type="submit"> Submit</button>
					</section>

</div>
</div>
</div>
</center>
			<div class="wrapper">
				<main>
					<h2> Calendar </h2>
					<div class="toolbar">
						<div class="current-month">April 2018</div>
					</div>
					<div class="calendar">
						<div class="calendar__header">
							<div>sun</div>
							<div>mon</div>
							<div>tue</div>
							<div>wed</div>
							<div>thu</div>
							<div>fri</div>
							<div>sat</div>

						</div>
						<div class="calendar__week">
							<div id="cal1" class="calendar__day day">1</div>
							<div id="cal2" class="calendar__day day">2</div>
							<div id="cal3" class="calendar__day day">3</div>
							<div id="cal4" class="calendar__day day">4</div>
							<div id="cal5" class="calendar__day day">5</div>
							<div id="cal6" class="calendar__day day">6</div>
							<div id="cal7" class="calendar__day day">7</div>
						</div>
						<div class="calendar__week">
							<div id="cal8" class="calendar__day day">8</div>
							<div id="cal9" class="calendar__day day">9</div>
							<div id="cal10" class="calendar__day day">10</div>
							<div id="cal11" class="calendar__day day">11</div>
							<div id="cal12" class="calendar__day day">12</div>
							<div id="cal13" class="calendar__day day">13</div>
							<div id="cal14" class="calendar__day day">14</div>
						</div>
						<div class="calendar__week">
							<div id="cal15" class="calendar__day day">15</div>
							<div id="cal16" class="calendar__day day">16</div>
							<div id="cal17" class="calendar__day day">17</div>
							<div id="cal18" class="calendar__day day">18</div>
							<div id="cal19" class="calendar__day day">19</div>
							<div id="cal20" class="calendar__day day">20</div>
							<div id="cal21" class="calendar__day day">21</div>
						</div>
						<div class="calendar__week">
							<div id="cal22" class="calendar__day day">22</div>
							<div id="cal23" class="calendar__day day">23</div>
							<div id="cal24" class="calendar__day day">24</div>
							<div id="cal25" class="calendar__day day">25</div>
							<div id="cal26" class="calendar__day day">26</div>
							<div id="cal27" class="calendar__day day">27</div>
							<div id="cal28" class="calendar__day day">28</div>
						</div>
						<div class="calendar__week">
							<div id="cal29" class="calendar__day day">29</div>
							<div id="cal30" class="calendar__day day">30</div>
							<div class="calendar__day day">1</div>
							<div class="calendar__day day">2</div>
							<div class="calendar__day day">3</div>
							<div class="calendar__day day">4</div>
							<div class="calendar__day day">5</div>

						</div>
					</div>
				</main>
			</div>
		</div>
	</article>
	</section>
</div>



	</div>

	<!-- Scripts -->
	<script type="text/javascript">
		var imgData;
		var str;
		var img = new Image;
		var regex = /(\d\/\d+)\s+(\d+).(\d+)/ig
		var date;
		var hours;
		var minutes;
		var event;
		var email;
		var day_id;
		//var ctx = canvas.getContext("2d");

		function readURL(input) {
			if (input.files && input.files[0]) {
				var reader = new FileReader();

				reader.onload = function(e) {
					imgData = e.target.result
					console.log(imgData);
				};

				reader.readAsDataURL(input.files[0]);
			}
		}
		/*  function callHaven(myImage){
		  	var xhr = new XMLHttpRequest()
		  	xhr.open("GET","https://api.havenondemand.com/1/api/sync/ocrdocument/v1?apikey= 0c55d2e1-96b8-4a22-b499-78673b06478c&file=" + myImage,false)
		  	xhr.send();
		  	console.log(xhr.responseText)
		  	str = xhr.responseText;


		 }*/
		function setCookie(name, value, days) {
			var d = new Date;
			d.setTime(d.getTime() + 24 * 60 * 60 * 1000 * days);
			document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
		}

		function getCookie(name) {
			var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
			return v ? v[2] : null;
		}

		function deleteCookie(name) {
			setCookie(name, '', -1);
		}

		function callOcrad(myImage) {
			img.src = myImage
			//ctx.drawImage(img,0,0)
			setTimeout(function() {
				var string = OCRAD(img)
				console.log(string)
				str = string;
				matches = regex.exec(str);
				console.log(matches)
				date = matches[1];
				day_id = date.substring(date.length - 2, date.length);
				console.log(day_id);
				hours = parseInt(matches[2]);
				minutes = parseInt(matches[3]);
				event = matches.input;
				sendToCalendar(date, hours, minutes, event)
			}, 3000);

			function sendToCalendar(date_given, hours, minutes, event_desc) {
				console.log(date_given)
				console.log(hours)
				console.log(minutes)
				console.log(event_desc)
				var d = new Date(date_given + "/" + (new Date()).getFullYear());
				console.log(d)
				d.setHours(hours, minutes);
				var event = {
					'summary': event_desc,
					'description': event_desc,
					'start': {
						'dateTime': d.toISOString(),
						'timeZone': 'America/Los_Angeles'
					},
					'end': {
						'dateTime': d.toISOString(),
						'timeZone': 'America/Los_Angeles'
					},
					'recurrence': [
						'RRULE:FREQ=DAILY;COUNT=1'
					],
					'attendees': [{
						'email': email
					}],
					'reminders': {
						'useDefault': false,
						'overrides': [{
								'method': 'email',
								'minutes': 24 * 60
							},
							{
								'method': 'popup',
								'minutes': 10
							}
						]
					}
				};

				var request = gapi.client.calendar.events.insert({
					'calendarId': 'primary',
					'resource': event
				});

				request.execute(function(event) {
					appendPre('Event created: ' + event_desc);
					console.log(event.htmlLink)
				});
				document.getElementById("cal" + day_id).innerHTML += "<div class='ev'> " + event_desc + "</div>";
			}

		}

		var CLIENT_ID = '776765416863-2lumdugsq4nu8ca1spmm2p40valta2t7.apps.googleusercontent.com';
		var API_KEY = 'AIzaSyBxz1isCpajACeRhgoPBP0krR90DBV9W54';
		var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
		var SCOPES = "https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/userinfo.email";

		var authorizeButton = document.getElementById('authorize-button');
		var signoutButton = document.getElementById('signout-button');

		function handleClientLoad() {
			gapi.load('client:auth2', initClient);
		}

		function initClient() {
			gapi.client.init({
				apiKey: API_KEY,
				clientId: CLIENT_ID,
				discoveryDocs: DISCOVERY_DOCS,
				scope: SCOPES
			}).then(function() {
				gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

				// Handle the initial sign-in state.
				console.log(gapi);
				console.log(gapi.auth2)
				updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
				authorizeButton.onclick = handleAuthClick;
				signoutButton.onclick = handleSignoutClick;
			});
		}

		function updateSigninStatus(isSignedIn) {
			if (isSignedIn) {
				authorizeButton.style.display = 'none';
				signoutButton.style.display = 'block';
				listUpcomingEvents();
				gapi.client.load('plus', 'v1', function() {
					var request = gapi.client.plus.people.get({
						'userId': 'me'
					});
					request.execute(function(resp) {
						email = resp.emails[0].value
						console.log(email);
					});
				});

			} else {
				authorizeButton.style.display = 'block';
				signoutButton.style.display = 'none';
			}
		}

		/**
		 *  Sign in the user upon button click.
		 */
		function handleAuthClick(event) {
			gapi.auth2.getAuthInstance().signIn();
		}

		/**
		 *  Sign out the user upon button click.
		 */
		function handleSignoutClick(event) {
			gapi.auth2.getAuthInstance().signOut();
		}

		function appendPre(message) {
			var pre = document.getElementById('content');
			var textContent = document.createTextNode(message + '\n');
			pre.appendChild(textContent);
		}

		function listUpcomingEvents() {
			gapi.client.calendar.events.list({
				'calendarId': 'primary',
				'timeMin': (new Date()).toISOString(),
				'showDeleted': false,
				'singleEvents': true,
				'maxResults': 10,
				'orderBy': 'startTime'
			}).then(function(response) {
				var events = response.result.items;
				appendPre('Upcoming events:');

				if (events.length > 0) {
					for (i = 0; i < events.length; i++) {
						var event = events[i];
						var when = event.start.dateTime;
						if (!when) {
							when = event.start.date;
						}
						var d = new Date(when);
						var tiempo = d.toLocaleString();;
						appendPre(event.summary + ' ' + tiempo + '.')
					}
				} else {
					appendPre('No upcoming events found.');
				}
			});
		}
	</script>
	<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
	</script>
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/skel.min.js"></script>
	<script src="assets/js/util.js"></script>
	<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	<script src="assets/js/main.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	<!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>!-->
</body>

</html>
