<!DOCTYPE HTML >
<html>

<head>
	<title>Snaptorial</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
	<link rel="stylesheet" href="assets/css/main.css" />
	<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css"  babakshay loves baru/><![endif]-->
	<script src="http://antimatter15.com/ocrad.js/ocrad.js">
	</script>

	<style>
		.right {
			position: relative;
			right: -1000px;
			top: 100px;
		}

		ul {
			list-style-type: none;
		}
	</style>
</head>

<body>
	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header">
			<div class="inner">

				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">Snaptorial</span>
				</a>

				<!-- Nav -->
				<nav>
					<ul>
						<li><a href="#menu">Menu</a></li>
					</ul>
				</nav>

			</div>
		</header>

		<!-- Menu -->
		<nav id="menu">
			<h2>Menu</h2>
			<ul>
				<li><a href="index.html">Home</a></li>

			</ul>
		</nav>

		<!-- Main -->
		<div id="main">
			<div class="inner">
				<header>
					<h1>Snaptorial
					</h1>
					<button id="authorize-button" style="display: none;">Authorize</button>
					<button id="signout-button" style="display: none;">Sign Out</button>
					<pre id="content"></pre>

					<section>
						<input id="image" type="file" onchange="readURL(this)" />
						<button onclick="callOcrad(imgData)" type="submit"> Submit</button>
					</section>


			</div>
			</article>
			</section>
		</div>


		<!-- Footer -->
		<footer id="footer">
			<div class="inner">


			</div>
		</footer>

	</div>

	<!-- Scripts -->
	<script type="text/javascript">
		var imgData;
		var str;
		var img = new Image;
		var regex = /(\d\/\d+)\s+(\d+).(\d+)/ig
		var date;
		var hours;
		var minutes;
		var event;
		//var ctx = canvas.getContext("2d");

		function readURL(input) {
			if (input.files && input.files[0]) {
				var reader = new FileReader();

				reader.onload = function(e) {
					imgData = e.target.result
					console.log(imgData);
				};

				reader.readAsDataURL(input.files[0]);
			}
		}
		/*  function callHaven(myImage){
		  	var xhr = new XMLHttpRequest()
		  	xhr.open("GET","https://api.havenondemand.com/1/api/sync/ocrdocument/v1?apikey= 0c55d2e1-96b8-4a22-b499-78673b06478c&file=" + myImage,false)
		  	xhr.send();
		  	console.log(xhr.responseText)
		  	str = xhr.responseText;


		 }*/

		function callOcrad(myImage) {
			img.src = myImage
			//ctx.drawImage(img,0,0)
			setTimeout(function() {
				var string = OCRAD(img)
				console.log(string)
				str = string;
				matches = regex.exec(str);
				console.log(matches)
				date = matches[1];
				hours = parseInt(matches[2]);
				minutes = parseInt(matches[3]);
				event = matches.input;
				sendToCalendar(date, hours, minutes, event)
			}, 3000);

			function sendToCalendar(date_given, hours, minutes, event_desc) {
				console.log(date_given)
				console.log(hours)
				console.log(minutes)
				console.log(event_desc)
				var d = new Date(date_given + "/" + (new Date()).getFullYear());
				console.log(d)
				d.setHours(hours, minutes);
				var event = {
					'summary': event_desc,
					'description': event_desc,
					'start': {
						'dateTime': d.toISOString(),
						'timeZone': 'America/Los_Angeles'
					},
					'end': {
						'dateTime': d.toISOString(),
						'timeZone': 'America/Los_Angeles'
					},
					'recurrence': [
						'RRULE:FREQ=DAILY;COUNT=1'
					],
					'attendees': [{
						'email': 'lpage@example.com'
					}],
					'reminders': {
						'useDefault': false,
						'overrides': [{
								'method': 'email',
								'minutes': 24 * 60
							},
							{
								'method': 'popup',
								'minutes': 10
							}
						]
					}
				};

				var request = gapi.client.calendar.events.insert({
					'calendarId': 'primary',
					'resource': event
				});

				request.execute(function(event) {
					appendPre('Event created: ' + event_desc);
				});
			}

		}

		var CLIENT_ID = '776765416863-2lumdugsq4nu8ca1spmm2p40valta2t7.apps.googleusercontent.com';
		var API_KEY = 'AIzaSyBxz1isCpajACeRhgoPBP0krR90DBV9W54';
		var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
		var SCOPES = ["https://www.googleapis.com/auth/calendar", "https://www.googleapis.com/auth/plus.me", "https://www.googleapis.com/auth/userinfo.email"];

		var authorizeButton = document.getElementById('authorize-button');
		var signoutButton = document.getElementById('signout-button');

		function handleClientLoad() {
			gapi.load('client:auth2', initClient);
		}

		function initClient() {
			gapi.client.init({
				apiKey: API_KEY,
				clientId: CLIENT_ID,
				discoveryDocs: DISCOVERY_DOCS,
				scope: SCOPES
			}).then(function() {
				gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

				// Handle the initial sign-in state.
				updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
				authorizeButton.onclick = handleAuthClick;
				signoutButton.onclick = handleSignoutClick;
			});
		}

		function updateSigninStatus(isSignedIn) {
			if (isSignedIn) {
				authorizeButton.style.display = 'none';
				signoutButton.style.display = 'block';
				listUpcomingEvents();
				var request = gapi.client.plus.people.get({
					'userId': 'me'
				});

				request.execute(function(resp) {
					console.log(resp);
				});

			} else {
				authorizeButton.style.display = 'block';
				signoutButton.style.display = 'none';
			}
		}

		/**
		 *  Sign in the user upon button click.
		 */
		function handleAuthClick(event) {
			gapi.auth2.getAuthInstance().signIn();
		}

		/**
		 *  Sign out the user upon button click.
		 */
		function handleSignoutClick(event) {
			gapi.auth2.getAuthInstance().signOut();
		}

		function appendPre(message) {
			var pre = document.getElementById('content');
			var textContent = document.createTextNode(message + '\n');
			pre.appendChild(textContent);
		}

		function listUpcomingEvents() {
			gapi.client.calendar.events.list({
				'calendarId': 'primary',
				'timeMin': (new Date()).toISOString(),
				'showDeleted': false,
				'singleEvents': true,
				'maxResults': 10,
				'orderBy': 'startTime'
			}).then(function(response) {
				var events = response.result.items;
				appendPre('Upcoming events:');

				if (events.length > 0) {
					for (i = 0; i < events.length; i++) {
						var event = events[i];
						var when = event.start.dateTime;
						if (!when) {
							when = event.start.date;
						}
						var d = new Date(when);
						var tiempo = d.toLocaleString();;
						appendPre(event.summary + ' ' + tiempo + '.')
					}
				} else {
					appendPre('No upcoming events found.');
				}
			});
		}
	</script>
	<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
	</script>

	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/skel.min.js"></script>
	<script src="assets/js/util.js"></script>
	<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
	<script src="assets/js/main.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	<!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>!-->
</body>

</html>
